# ğŸ¨ Web3å‰ç«¯å¼€å‘å®æˆ˜æ•™ç¨‹

> **ä»é›¶å¼€å§‹ï¼Œæ‰‹æŠŠæ‰‹æ•™ä½ æ„å»ºç°ä»£åŒ–çš„Web3å‰ç«¯åº”ç”¨**

## ğŸ¯ å­¦ä¹ ç›®æ ‡

é€šè¿‡è¿™ä¸ªæ•™ç¨‹ï¼Œä½ å°†å­¦ä¼šï¼š
- âœ… React 19 + TypeScript + Vite ç°ä»£å‰ç«¯å¼€å‘
- âœ… Wagmi v2 + Viem v2 Web3é›†æˆå®æˆ˜
- âœ… é’±åŒ…è¿æ¥å’Œç½‘ç»œç®¡ç†
- âœ… æ™ºèƒ½åˆçº¦äº¤äº’å’ŒçŠ¶æ€ç®¡ç†
- âœ… ç°ä»£åŒ–UIè®¾è®¡å’Œç”¨æˆ·ä½“éªŒä¼˜åŒ–
- âœ… æ€§èƒ½ä¼˜åŒ–å’Œéƒ¨ç½²ç­–ç•¥

## ğŸ“š å‰ç½®çŸ¥è¯†

### å¿…é¡»æŒæ¡ï¼š
- ReactåŸºç¡€è¯­æ³•å’ŒHooks
- TypeScriptåŸºæœ¬æ¦‚å¿µ
- CSS/HTMLåŸºç¡€
- å‘½ä»¤è¡Œæ“ä½œ

### å»ºè®®äº†è§£ï¼š
- Web3å’ŒåŒºå—é“¾åŸºæœ¬æ¦‚å¿µ
- æ™ºèƒ½åˆçº¦äº¤äº’åŸç†
- ç°ä»£å‰ç«¯å·¥ç¨‹åŒ–

---

## ğŸš€ ç¬¬ä¸€æ­¥ï¼šé¡¹ç›®åˆå§‹åŒ–å®æˆ˜

### åˆ›å»ºé¡¹ç›®å¹¶å®‰è£…ä¾èµ–

```bash
# 1. åˆ›å»ºViteé¡¹ç›®
npm create vite@latest red-packet-frontend -- --template react-ts
cd red-packet-frontend

# 2. å®‰è£…åŸºç¡€ä¾èµ–
npm install

# 3. å®‰è£…Web3æ ¸å¿ƒåº“
npm install wagmi@^2.12.0 viem@^2.17.0 @tanstack/react-query@^5.50.0

# 4. å®‰è£…é’±åŒ…è¿æ¥å™¨
npm install @wagmi/connectors @wagmi/core

# 5. å®‰è£…GraphQLå®¢æˆ·ç«¯ï¼ˆç”¨äºThe Graphï¼‰
npm install @apollo/client graphql

# 6. å®‰è£…UIç»„ä»¶åº“
npm install @radix-ui/react-dialog @radix-ui/react-dropdown-menu
npm install @radix-ui/react-toast @radix-ui/react-switch
npm install lucide-react clsx tailwind-merge

# 7. å®‰è£…å¼€å‘ä¾èµ–
npm install --save-dev @types/node
npm install --save-dev tailwindcss@latest postcss@latest autoprefixer@latest

# 8. åˆå§‹åŒ–Tailwind CSS
npx tailwindcss init -p
```

### é…ç½®Tailwind CSS

**ä¿®æ”¹ `tailwind.config.js`**:
```javascript
/** @type {import('tailwindcss').Config} */
export default {
  content: [
    "./index.html",
    "./src/**/*.{js,ts,jsx,tsx}",
  ],
  theme: {
    extend: {
      colors: {
        // çº¢åŒ…ä¸»é¢˜è‰²å½©
        'red-packet': {
          50: '#fef2f2',
          100: '#fee2e2', 
          500: '#ef4444',
          600: '#dc2626',
          700: '#b91c1c',
        },
        // é‡‘è‰²ä¸»é¢˜è‰²å½©
        'gold': {
          50: '#fffbeb',
          100: '#fef3c7',
          500: '#f59e0b',
          600: '#d97706',
        }
      },
      animation: {
        'bounce-in': 'bounceIn 0.6s ease-out',
        'fade-in': 'fadeIn 0.3s ease-in',
        'shake': 'shake 0.5s ease-in-out',
      },
      keyframes: {
        bounceIn: {
          '0%': { transform: 'scale(0.3)', opacity: '0' },
          '50%': { transform: 'scale(1.05)' },
          '70%': { transform: 'scale(0.9)' },
          '100%': { transform: 'scale(1)', opacity: '1' },
        },
        fadeIn: {
          '0%': { opacity: '0', transform: 'translateY(10px)' },
          '100%': { opacity: '1', transform: 'translateY(0)' },
        },
        shake: {
          '0%, 100%': { transform: 'translateX(0)' },
          '10%, 30%, 50%, 70%, 90%': { transform: 'translateX(-10px)' },
          '20%, 40%, 60%, 80%': { transform: 'translateX(10px)' },
        }
      }
    },
  },
  plugins: [],
}
```

**åˆ›å»º `src/index.css`**:
```css
@tailwind base;
@tailwind components;
@tailwind utilities;

/* è‡ªå®šä¹‰åŸºç¡€æ ·å¼ */
@layer base {
  html {
    font-family: system-ui, sans-serif;
  }
  
  body {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
  }
}

/* è‡ªå®šä¹‰ç»„ä»¶æ ·å¼ */
@layer components {
  .btn-primary {
    @apply bg-red-packet-600 hover:bg-red-packet-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors duration-200;
  }
  
  .btn-secondary {
    @apply bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold py-2 px-4 rounded-lg transition-colors duration-200;
  }
  
  .card {
    @apply bg-white/90 backdrop-blur-sm rounded-2xl shadow-xl border border-white/20;
  }
  
  .glass-card {
    @apply bg-white/10 backdrop-blur-md rounded-2xl border border-white/20 shadow-xl;
  }
}

/* å·¥å…·ç±» */
@layer utilities {
  .text-gradient {
    @apply bg-gradient-to-r from-red-packet-500 to-gold-500 bg-clip-text text-transparent;
  }
}
```

### é¡¹ç›®ç»“æ„è®¾è®¡

```bash
# åˆ›å»ºæ ‡å‡†é¡¹ç›®ç»“æ„
mkdir -p src/{components,hooks,types,utils,constants,pages}
mkdir -p src/components/{ui,layout,features}
mkdir -p src/hooks/{contracts,web3}
mkdir -p src/types/{contracts,api}
mkdir -p src/utils/{format,validation}

# åˆ›å»ºæ ¸å¿ƒæ–‡ä»¶
touch src/types/contracts/RedPacketSystem.ts
touch src/constants/contracts.ts
touch src/constants/networks.ts
touch src/hooks/web3/useWeb3Config.ts
touch src/hooks/contracts/useRedPacketSystem.ts
touch src/components/layout/Header.tsx
touch src/components/features/ConnectWallet.tsx
touch src/pages/HomePage.tsx
```

**æ–‡ä»¶ç»“æ„ä¸€è§ˆ**:
```
src/
â”œâ”€â”€ components/           # ç»„ä»¶ç›®å½•
â”‚   â”œâ”€â”€ ui/              # é€šç”¨UIç»„ä»¶
â”‚   â”œâ”€â”€ layout/          # å¸ƒå±€ç»„ä»¶
â”‚   â””â”€â”€ features/        # åŠŸèƒ½ç»„ä»¶
â”œâ”€â”€ hooks/               # è‡ªå®šä¹‰Hooks
â”‚   â”œâ”€â”€ contracts/       # åˆçº¦ç›¸å…³
â”‚   â””â”€â”€ web3/           # Web3ç›¸å…³
â”œâ”€â”€ types/               # ç±»å‹å®šä¹‰
â”œâ”€â”€ utils/               # å·¥å…·å‡½æ•°
â”œâ”€â”€ constants/           # å¸¸é‡é…ç½®
â”œâ”€â”€ pages/              # é¡µé¢ç»„ä»¶
â””â”€â”€ styles/             # æ ·å¼æ–‡ä»¶
```

---

## ğŸ’¡ ç¬¬äºŒæ­¥ï¼šWeb3é…ç½®å®æˆ˜

### 1. ç½‘ç»œé…ç½®

**åˆ›å»º `src/constants/networks.ts`**:

```typescript
import { Chain } from 'viem'
import { sepolia, mainnet, polygon, arbitrum, optimism, bsc, holesky, goerli } from 'viem/chains'

/**
 * ç½‘ç»œé…ç½®ä¿¡æ¯
 */
export interface NetworkInfo {
  id: number
  name: string
  symbol: string
  color: string
  icon: string
  isRecommended?: boolean
  hasRedPacketContract?: boolean
}

/**
 * æ”¯æŒçš„ç½‘ç»œåˆ—è¡¨
 */
export const SUPPORTED_NETWORKS: NetworkInfo[] = [
  // æ¨èç½‘ç»œ
  {
    id: sepolia.id,
    name: "Sepolia Testnet",
    symbol: "ETH",
    color: "bg-purple-500",
    icon: "ğŸ”§",
    isRecommended: true,
    hasRedPacketContract: true,
  },
  
  // å…¶ä»–æ”¯æŒç½‘ç»œ
  {
    id: mainnet.id,
    name: "Ethereum Mainnet", 
    symbol: "ETH",
    color: "bg-blue-500",
    icon: "ğŸŒ",
  },
  {
    id: polygon.id,
    name: "Polygon",
    symbol: "MATIC", 
    color: "bg-purple-600",
    icon: "ğŸ’œ",
  },
  {
    id: arbitrum.id,
    name: "Arbitrum One",
    symbol: "ETH",
    color: "bg-blue-600", 
    icon: "ğŸ”µ",
  },
  {
    id: optimism.id,
    name: "Optimism",
    symbol: "ETH",
    color: "bg-red-500",
    icon: "ğŸ”´",
  },
  {
    id: bsc.id,
    name: "BSC",
    symbol: "BNB",
    color: "bg-yellow-500",
    icon: "ğŸŸ¡",
  },
  {
    id: holesky.id,
    name: "Holesky Testnet",
    symbol: "ETH", 
    color: "bg-orange-500",
    icon: "ğŸ¯",
  },
  {
    id: goerli.id,
    name: "Goerli Testnet",
    symbol: "ETH",
    color: "bg-blue-400", 
    icon: "ğŸ§ª",
  },
]

/**
 * è·å–ç½‘ç»œä¿¡æ¯
 */
export function getNetworkInfo(chainId: number): NetworkInfo | undefined {
  return SUPPORTED_NETWORKS.find(network => network.id === chainId)
}

/**
 * æ¨èç½‘ç»œ
 */
export const RECOMMENDED_NETWORKS = SUPPORTED_NETWORKS.filter(n => n.isRecommended)

/**
 * æ”¯æŒçº¢åŒ…åˆçº¦çš„ç½‘ç»œ
 */
export const RED_PACKET_NETWORKS = SUPPORTED_NETWORKS.filter(n => n.hasRedPacketContract)

/**
 * Viemé“¾é…ç½®æ˜ å°„
 */
export const CHAIN_CONFIG: Record<number, Chain> = {
  [sepolia.id]: sepolia,
  [mainnet.id]: mainnet,
  [polygon.id]: polygon,
  [arbitrum.id]: arbitrum,
  [optimism.id]: optimism,
  [bsc.id]: bsc,
  [holesky.id]: holesky,
  [goerli.id]: goerli,
}
```

### 2. åˆçº¦é…ç½®

**åˆ›å»º `src/constants/contracts.ts`**:

```typescript
import { Address } from 'viem'
import { sepolia } from 'viem/chains'

/**
 * åˆçº¦åœ°å€é…ç½®
 */
export const CONTRACT_ADDRESSES: Record<number, { redPacketSystem: Address }> = {
  // Sepoliaæµ‹è¯•ç½‘
  [sepolia.id]: {
    redPacketSystem: '0x4e659F1DB6E5475800A6E8d12F0f6dd25c65960f',
  },
  
  // å…¶ä»–ç½‘ç»œå¯ä»¥åœ¨è¿™é‡Œæ·»åŠ 
  // [mainnet.id]: {
  //   redPacketSystem: '0x...',
  // },
}

/**
 * è·å–åˆçº¦åœ°å€
 */
export function getContractAddress(chainId: number, contractName: keyof typeof CONTRACT_ADDRESSES[number]): Address | undefined {
  return CONTRACT_ADDRESSES[chainId]?.[contractName]
}

/**
 * The Graphå­å›¾ç«¯ç‚¹
 */
export const SUBGRAPH_ENDPOINTS: Record<number, string> = {
  [sepolia.id]: 'https://api.studio.thegraph.com/query/your-subgraph-id/red-packet-sepolia/version/latest',
}

/**
 * è·å–å­å›¾ç«¯ç‚¹
 */
export function getSubgraphEndpoint(chainId: number): string | undefined {
  return SUBGRAPH_ENDPOINTS[chainId]
}

/**
 * çº¢åŒ…ç³»ç»Ÿåˆçº¦ABIï¼ˆç®€åŒ–ç‰ˆæœ¬ï¼Œå®é™…ä½¿ç”¨åº”è¯¥ä»artifactså¯¼å…¥ï¼‰
 */
export const RED_PACKET_SYSTEM_ABI = [
  // è¯»å–å‡½æ•°
  {
    inputs: [],
    name: 'packetCounter',
    outputs: [{ internalType: 'uint256', name: '', type: 'uint256' }],
    stateMutability: 'view',
    type: 'function',
  },
  {
    inputs: [{ internalType: 'uint256', name: '', type: 'uint256' }],
    name: 'packets',
    outputs: [
      { internalType: 'address', name: 'owner', type: 'address' },
      { internalType: 'string', name: 'message', type: 'string' },
      { internalType: 'uint256', name: 'totalAmount', type: 'uint256' },
      { internalType: 'uint256', name: 'balance', type: 'uint256' },
      { internalType: 'uint256', name: 'totalCount', type: 'uint256' },
      { internalType: 'uint256', name: 'claimedCount', type: 'uint256' },
      { internalType: 'bool', name: 'isEven', type: 'bool' },
      { internalType: 'uint256', name: 'creationTime', type: 'uint256' },
    ],
    stateMutability: 'view',
    type: 'function',
  },
  {
    inputs: [
      { internalType: 'uint256', name: '', type: 'uint256' },
      { internalType: 'address', name: '', type: 'address' },
    ],
    name: 'hasClaimed',
    outputs: [{ internalType: 'bool', name: '', type: 'bool' }],
    stateMutability: 'view',
    type: 'function',
  },
  
  // å†™å…¥å‡½æ•°
  {
    inputs: [
      { internalType: 'string', name: '_message', type: 'string' },
      { internalType: 'uint256', name: '_count', type: 'uint256' },
      { internalType: 'bool', name: '_isEven', type: 'bool' },
    ],
    name: 'createRedPacket',
    outputs: [],
    stateMutability: 'payable',
    type: 'function',
  },
  {
    inputs: [{ internalType: 'uint256', name: '_packetId', type: 'uint256' }],
    name: 'claimRedPacket',
    outputs: [],
    stateMutability: 'nonpayable',
    type: 'function',
  },
  {
    inputs: [{ internalType: 'uint256', name: '_packetId', type: 'uint256' }],
    name: 'withdraw',
    outputs: [],
    stateMutability: 'nonpayable',
    type: 'function',
  },
  
  // äº‹ä»¶
  {
    anonymous: false,
    inputs: [
      { indexed: true, internalType: 'uint256', name: 'packetId', type: 'uint256' },
      { indexed: true, internalType: 'address', name: 'creator', type: 'address' },
      { indexed: false, internalType: 'string', name: 'message', type: 'string' },
      { indexed: false, internalType: 'uint256', name: 'totalAmount', type: 'uint256' },
      { indexed: false, internalType: 'uint256', name: 'totalCount', type: 'uint256' },
      { indexed: false, internalType: 'bool', name: 'isEven', type: 'bool' },
    ],
    name: 'PacketCreated',
    type: 'event',
  },
  {
    anonymous: false,
    inputs: [
      { indexed: true, internalType: 'uint256', name: 'packetId', type: 'uint256' },
      { indexed: true, internalType: 'address', name: 'claimer', type: 'address' },
      { indexed: false, internalType: 'uint256', name: 'amount', type: 'uint256' },
    ],
    name: 'PacketClaimed',
    type: 'event',
  },
  {
    anonymous: false,
    inputs: [
      { indexed: true, internalType: 'uint256', name: 'packetId', type: 'uint256' },
      { indexed: true, internalType: 'address', name: 'claimer', type: 'address' },
    ],
    name: 'AlreadyClaimed',
    type: 'event',
  },
  {
    anonymous: false,
    inputs: [
      { indexed: true, internalType: 'uint256', name: 'packetId', type: 'uint256' },
      { indexed: true, internalType: 'address', name: 'owner', type: 'address' },
      { indexed: false, internalType: 'uint256', name: 'amount', type: 'uint256' },
    ],
    name: 'FundsWithdrawn',
    type: 'event',
  },
] as const
```

### 3. Web3é…ç½®Hook

**åˆ›å»º `src/hooks/web3/useWeb3Config.ts`**:

```typescript
'use client'

import { http, createConfig } from 'wagmi'
import { sepolia, mainnet, polygon, arbitrum, optimism, bsc, holesky, goerli } from 'wagmi/chains'
import { metaMask, injected, walletConnect } from 'wagmi/connectors'

/**
 * Wagmié…ç½®
 */
export const wagmiConfig = createConfig({
  chains: [sepolia, mainnet, polygon, arbitrum, optimism, bsc, holesky, goerli],
  connectors: [
    metaMask(),
    injected(),
    walletConnect({
      projectId: 'your_walletconnect_project_id', // æ›¿æ¢ä¸ºå®é™…çš„é¡¹ç›®ID
    }),
  ],
  transports: {
    [sepolia.id]: http(),
    [mainnet.id]: http(), 
    [polygon.id]: http(),
    [arbitrum.id]: http(),
    [optimism.id]: http(),
    [bsc.id]: http(),
    [holesky.id]: http(),
    [goerli.id]: http(),
  },
})

declare module 'wagmi' {
  interface Register {
    config: typeof wagmiConfig
  }
}
```

### 4. ç±»å‹å®šä¹‰

**åˆ›å»º `src/types/contracts/RedPacketSystem.ts`**:

```typescript
import { Address } from 'viem'

/**
 * çº¢åŒ…æ•°æ®ç»“æ„
 */
export interface RedPacket {
  id: string
  owner: Address
  message: string
  totalAmount: bigint
  balance: bigint
  totalCount: bigint
  claimedCount: bigint
  isEven: boolean
  creationTime: bigint
  // è®¡ç®—å±æ€§
  isExpired: boolean
  canWithdraw: boolean
  isFullyClaimed: boolean
  averageAmount: bigint
  progressPercentage: number
}

/**
 * é¢†å–è®°å½•
 */
export interface ClaimRecord {
  id: string
  packetId: string
  claimer: Address
  amount: bigint
  timestamp: bigint
  transactionHash: string
}

/**
 * åˆçº¦äº¤äº’çŠ¶æ€
 */
export interface ContractOperationState {
  isLoading: boolean
  isSuccess: boolean
  isError: boolean
  error?: string
  transactionHash?: string
}

/**
 * åˆ›å»ºçº¢åŒ…å‚æ•°
 */
export interface CreateRedPacketParams {
  message: string
  count: bigint
  isEven: boolean
  value: bigint
}

/**
 * ç½‘ç»œçŠ¶æ€
 */
export interface NetworkState {
  chainId: number | undefined
  isConnected: boolean
  isWrongNetwork: boolean
  supportedChainIds: number[]
}
```

---

## ğŸ”— ç¬¬ä¸‰æ­¥ï¼šé’±åŒ…è¿æ¥å®æˆ˜

## ğŸ—ï¸ å¼€å‘ç¯å¢ƒæ­å»º

### 1. é¡¹ç›®åˆå§‹åŒ–

```bash
# åˆ›å»ºVite + React + TypeScripté¡¹ç›®
npm create vite@latest red-packet-frontend -- --template react-ts
cd red-packet-frontend

# å®‰è£…åŸºç¡€ä¾èµ–
npm install
```

### 2. å®‰è£…Web3ä¾èµ–

```bash
# æ ¸å¿ƒWeb3åº“
npm install wagmi viem @tanstack/react-query

# Wallet Connectors
npm install @wagmi/connectors

# GraphQLå®¢æˆ·ç«¯
npm install @apollo/client graphql

# UIå’Œæ ·å¼åº“
npm install @radix-ui/react-dialog @radix-ui/react-toast
npm install lucide-react clsx tailwind-merge

# å·¥å…·åº“
npm install @viem/anvil
```

### 3. å¼€å‘å·¥å…·é…ç½®

```bash
# å¼€å‘ä¾èµ–
npm install --save-dev @types/node
npm install --save-dev tailwindcss postcss autoprefixer
npm install --save-dev eslint-plugin-react-hooks
```

### 4. Tailwind CSSé…ç½®

**tailwind.config.js**:
```javascript
/** @type {import('tailwindcss').Config} */
export default {
  content: [
    "./index.html",
    "./src/**/*.{js,ts,jsx,tsx}",
  ],
  theme: {
    extend: {
      colors: {
        primary: {
          50: '#fef2f2',
          100: '#fee2e2', 
          500: '#ef4444',
          600: '#dc2626',
          700: '#b91c1c',
        },
        accent: {
          50: '#fff7ed',
          100: '#ffedd5',
          500: '#f97316',
          600: '#ea580c',
        }
      },
      animation: {
        'bounce-slow': 'bounce 2s infinite',
        'pulse-fast': 'pulse 1s infinite',
      }
    },
  },
  plugins: [],
}
```

### 5. TypeScripté…ç½®ä¼˜åŒ–

**tsconfig.json**:
```json
{
  "compilerOptions": {
    "target": "ES2020",
    "useDefineForClassFields": true,
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "skipLibCheck": true,
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "react-jsx",
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,
    "baseUrl": ".",
    "paths": {
      "@/*": ["./src/*"],
      "@/components/*": ["./src/components/*"],
      "@/hooks/*": ["./src/hooks/*"],
      "@/lib/*": ["./src/lib/*"],
      "@/types/*": ["./src/types/*"]
    }
  },
  "include": ["src"],
  "references": [{ "path": "./tsconfig.node.json" }]
}
```

## ğŸ’¡ æ ¸å¿ƒæ¶æ„å®ç°

### 1. Web3é…ç½®è®¾ç½®

**src/lib/web3.ts**:
```typescript
import { createConfig, http } from 'wagmi'
import { sepolia } from 'wagmi/chains'
import { injected, metaMask, walletConnect } from 'wagmi/connectors'
import { QueryClient } from '@tanstack/react-query'

// åˆ›å»ºæŸ¥è¯¢å®¢æˆ·ç«¯
export const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      staleTime: 1000 * 60 * 2, // 2åˆ†é’Ÿ
      cacheTime: 1000 * 60 * 10, // 10åˆ†é’Ÿ
      refetchOnWindowFocus: false,
      retry: 3,
    },
  },
})

// Wagmié…ç½®
export const wagmiConfig = createConfig({
  chains: [sepolia],
  connectors: [
    injected(),
    metaMask(),
    walletConnect({ 
      projectId: import.meta.env.VITE_WALLET_CONNECT_PROJECT_ID 
    }),
  ],
  transports: {
    [sepolia.id]: http(import.meta.env.VITE_SEPOLIA_RPC_URL),
  },
  ssr: false,
})

// åˆçº¦é…ç½®
export const RED_PACKET_ADDRESS = '0x4e659F1DB6E5475800A6E8d12F0f6dd25c65960f' as const
export const SEPOLIA_CHAIN_ID = sepolia.id
```

### 2. åˆçº¦ABIå’Œç±»å‹å®šä¹‰

**src/types/contracts.ts**:
```typescript
import type { Address } from 'viem'

// çº¢åŒ…ç»“æ„ä½“ç±»å‹
export interface RedPacket {
  owner: Address
  message: string
  totalAmount: bigint
  balance: bigint
  totalCount: bigint
  claimedCount: bigint
  isEven: boolean
  creationTime: bigint
}

// çº¢åŒ…åˆ›å»ºå‚æ•°
export interface CreateRedPacketParams {
  message: string
  count: bigint
  isEven: boolean
  value: bigint
}

// äº‹ä»¶ç±»å‹
export interface PacketCreatedEvent {
  packetId: bigint
  creator: Address
  message: string
  totalAmount: bigint
  totalCount: bigint
  isEven: boolean
}

export interface PacketClaimedEvent {
  packetId: bigint
  claimer: Address
  amount: bigint
}

// åˆçº¦ABI
export const RED_PACKET_ABI = [
  {
    type: 'function',
    name: 'createRedPacket',
    inputs: [
      { name: '_message', type: 'string' },
      { name: '_count', type: 'uint256' },
      { name: '_isEven', type: 'bool' }
    ],
    outputs: [],
    stateMutability: 'payable'
  },
  {
    type: 'function',
    name: 'claimRedPacket',
    inputs: [{ name: '_packetId', type: 'uint256' }],
    outputs: [],
    stateMutability: 'nonpayable'
  },
  {
    type: 'function',
    name: 'packets',
    inputs: [{ name: '', type: 'uint256' }],
    outputs: [
      { name: 'owner', type: 'address' },
      { name: 'message', type: 'string' },
      { name: 'totalAmount', type: 'uint256' },
      { name: 'balance', type: 'uint256' },
      { name: 'totalCount', type: 'uint256' },
      { name: 'claimedCount', type: 'uint256' },
      { name: 'isEven', type: 'bool' },
      { name: 'creationTime', type: 'uint256' }
    ],
    stateMutability: 'view'
  },
  {
    type: 'function',
    name: 'hasClaimed',
    inputs: [
      { name: '', type: 'uint256' },
      { name: '', type: 'address' }
    ],
    outputs: [{ name: '', type: 'bool' }],
    stateMutability: 'view'
  },
  {
    type: 'event',
    name: 'PacketCreated',
    inputs: [
      { name: 'packetId', type: 'uint256', indexed: true },
      { name: 'creator', type: 'address', indexed: true },
      { name: 'message', type: 'string', indexed: false },
      { name: 'totalAmount', type: 'uint256', indexed: false },
      { name: 'totalCount', type: 'uint256', indexed: false },
      { name: 'isEven', type: 'bool', indexed: false }
    ]
  },
  {
    type: 'event',
    name: 'PacketClaimed',
    inputs: [
      { name: 'packetId', type: 'uint256', indexed: true },
      { name: 'claimer', type: 'address', indexed: true },
      { name: 'amount', type: 'uint256', indexed: false }
    ]
  }
] as const
```

### 3. è‡ªå®šä¹‰Hooksè®¾è®¡

**src/hooks/useRedPacket.ts**:
```typescript
import { useReadContract, useWriteContract, useWaitForTransactionReceipt } from 'wagmi'
import { RED_PACKET_ADDRESS, RED_PACKET_ABI } from '@/lib/web3'
import { toast } from 'sonner'
import type { CreateRedPacketParams } from '@/types/contracts'

// è¯»å–çº¢åŒ…ä¿¡æ¯
export function useRedPacket(packetId: bigint) {
  return useReadContract({
    address: RED_PACKET_ADDRESS,
    abi: RED_PACKET_ABI,
    functionName: 'packets',
    args: [packetId],
    query: {
      enabled: packetId > 0n,
      refetchInterval: 5000, // 5ç§’è‡ªåŠ¨åˆ·æ–°
    }
  })
}

// æ£€æŸ¥æ˜¯å¦å·²é¢†å–
export function useHasClaimed(packetId: bigint, address?: `0x${string}`) {
  return useReadContract({
    address: RED_PACKET_ADDRESS,
    abi: RED_PACKET_ABI,
    functionName: 'hasClaimed',
    args: [packetId, address!],
    query: {
      enabled: Boolean(address && packetId > 0n),
    }
  })
}

// åˆ›å»ºçº¢åŒ…
export function useCreateRedPacket() {
  const { writeContract, data: hash, isPending } = useWriteContract()
  
  const { isLoading: isConfirming, isSuccess } = useWaitForTransactionReceipt({ 
    hash 
  })

  const createRedPacket = async (params: CreateRedPacketParams) => {
    try {
      await writeContract({
        address: RED_PACKET_ADDRESS,
        abi: RED_PACKET_ABI,
        functionName: 'createRedPacket',
        args: [params.message, params.count, params.isEven],
        value: params.value,
      })
      
      toast.success('çº¢åŒ…åˆ›å»ºäº¤æ˜“å·²æäº¤ï¼Œç­‰å¾…ç¡®è®¤...')
    } catch (error) {
      toast.error('çº¢åŒ…åˆ›å»ºå¤±è´¥')
      throw error
    }
  }

  return {
    createRedPacket,
    isLoading: isPending || isConfirming,
    isSuccess,
    hash
  }
}

// æŠ¢çº¢åŒ…
export function useClaimRedPacket() {
  const { writeContract, data: hash, isPending } = useWriteContract()
  
  const { isLoading: isConfirming, isSuccess } = useWaitForTransactionReceipt({ 
    hash 
  })

  const claimRedPacket = async (packetId: bigint) => {
    try {
      await writeContract({
        address: RED_PACKET_ADDRESS,
        abi: RED_PACKET_ABI,
        functionName: 'claimRedPacket',
        args: [packetId],
      })
      
      toast.success('æŠ¢çº¢åŒ…äº¤æ˜“å·²æäº¤ï¼Œç­‰å¾…ç¡®è®¤...')
    } catch (error) {
      toast.error('æŠ¢çº¢åŒ…å¤±è´¥')
      throw error
    }
  }

  return {
    claimRedPacket,
    isLoading: isPending || isConfirming,
    isSuccess,
    hash
  }
}
```

### 4. GraphQLé›†æˆ

**src/lib/apollo.ts**:
```typescript
import { ApolloClient, InMemoryCache, createHttpLink } from '@apollo/client'

const httpLink = createHttpLink({
  uri: import.meta.env.VITE_SUBGRAPH_URL || 'https://api.studio.thegraph.com/query/your-subgraph',
})

export const apolloClient = new ApolloClient({
  link: httpLink,
  cache: new InMemoryCache({
    typePolicies: {
      RedPacket: {
        keyFields: ['id'],
      },
      Claim: {
        keyFields: ['id'],
      },
    },
  }),
  defaultOptions: {
    watchQuery: {
      fetchPolicy: 'cache-and-network',
      pollInterval: 10000, // 10ç§’è½®è¯¢
    },
  },
})
```

**src/graphql/queries.ts**:
```typescript
import { gql } from '@apollo/client'

export const GET_RED_PACKETS = gql`
  query GetRedPackets($first: Int = 10, $skip: Int = 0, $orderBy: String = "creationTime", $orderDirection: String = "desc") {
    redPackets(first: $first, skip: $skip, orderBy: $orderBy, orderDirection: $orderDirection) {
      id
      creator
      message
      totalAmount
      totalCount
      claimedCount
      isEven
      creationTime
      claims {
        id
        claimer
        amount
        timestamp
      }
    }
  }
`

export const GET_USER_PACKETS = gql`
  query GetUserPackets($creator: Bytes!) {
    redPackets(where: { creator: $creator }, orderBy: creationTime, orderDirection: desc) {
      id
      message
      totalAmount
      totalCount
      claimedCount
      isEven
      creationTime
      claims {
        id
        claimer
        amount
        timestamp
      }
    }
  }
`

export const GET_PACKET_CLAIMS = gql`
  query GetPacketClaims($packetId: ID!) {
    redPacket(id: $packetId) {
      id
      creator
      message
      totalAmount
      totalCount
      claimedCount
      claims {
        id
        claimer
        amount
        timestamp
      }
    }
  }
`
```

## ğŸ¨ ç»„ä»¶å¼€å‘å®æˆ˜

### 1. é’±åŒ…è¿æ¥ç»„ä»¶

**src/components/ConnectWallet.tsx**:
```tsx
import { useAccount, useConnect, useDisconnect } from 'wagmi'
import { Button } from '@/components/ui/Button'
import { Wallet, LogOut } from 'lucide-react'
import { toast } from 'sonner'

export function ConnectWallet() {
  const { address, isConnected } = useAccount()
  const { connect, connectors, isPending } = useConnect({
    mutation: {
      onSuccess: () => {
        toast.success('é’±åŒ…è¿æ¥æˆåŠŸ!')
      },
      onError: (error) => {
        toast.error(`è¿æ¥å¤±è´¥: ${error.message}`)
      }
    }
  })
  const { disconnect } = useDisconnect()

  if (isConnected) {
    return (
      <div className="flex items-center gap-4">
        <div className="text-sm text-gray-600">
          {address?.slice(0, 6)}...{address?.slice(-4)}
        </div>
        <Button 
          variant="outline" 
          size="sm"
          onClick={() => disconnect()}
          className="flex items-center gap-2"
        >
          <LogOut className="w-4 h-4" />
          æ–­å¼€è¿æ¥
        </Button>
      </div>
    )
  }

  return (
    <div className="flex flex-col gap-2">
      <h3 className="text-lg font-semibold mb-2">è¿æ¥é’±åŒ…</h3>
      {connectors.map((connector) => (
        <Button
          key={connector.id}
          onClick={() => connect({ connector })}
          disabled={isPending}
          className="flex items-center gap-2"
        >
          <Wallet className="w-4 h-4" />
          è¿æ¥åˆ° {connector.name}
          {isPending && connector.id === connector.id && ' (è¿æ¥ä¸­...)'}
        </Button>
      ))}
    </div>
  )
}
```

### 2. åˆ›å»ºçº¢åŒ…ç»„ä»¶

**src/components/CreateRedPacket.tsx**:
```tsx
import { useState, useEffect } from 'react'
import { parseEther, formatEther } from 'viem'
import { useCreateRedPacket } from '@/hooks/useRedPacket'
import { Button } from '@/components/ui/Button'
import { Input } from '@/components/ui/Input'
import { Label } from '@/components/ui/Label'
import { Switch } from '@/components/ui/Switch'
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/Card'
import { Gift, Loader2 } from 'lucide-react'
import { toast } from 'sonner'

export function CreateRedPacket() {
  const [formData, setFormData] = useState({
    message: '',
    amount: '',
    count: '',
    isEven: false
  })
  const [errors, setErrors] = useState<Record<string, string>>({})

  const { createRedPacket, isLoading, isSuccess, hash } = useCreateRedPacket()

  // è¡¨å•éªŒè¯
  const validateForm = () => {
    const newErrors: Record<string, string> = {}

    if (!formData.message.trim()) {
      newErrors.message = 'è¯·è¾“å…¥ç¥ç¦è¯­'
    }

    if (!formData.amount || parseFloat(formData.amount) <= 0) {
      newErrors.amount = 'è¯·è¾“å…¥æœ‰æ•ˆçš„çº¢åŒ…é‡‘é¢'
    }

    if (!formData.count || parseInt(formData.count) <= 0) {
      newErrors.count = 'è¯·è¾“å…¥æœ‰æ•ˆçš„çº¢åŒ…ä»½æ•°'
    }

    const amount = parseFloat(formData.amount || '0')
    const count = parseInt(formData.count || '0')
    if (amount > 0 && count > 0 && amount / count < 0.000001) {
      newErrors.amount = 'æ¯ä»½çº¢åŒ…è‡³å°‘éœ€è¦ 0.000001 ETH'
    }

    setErrors(newErrors)
    return Object.keys(newErrors).length === 0
  }

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()
    
    if (!validateForm()) return

    try {
      await createRedPacket({
        message: formData.message,
        count: BigInt(formData.count),
        isEven: formData.isEven,
        value: parseEther(formData.amount)
      })
    } catch (error) {
      console.error('åˆ›å»ºçº¢åŒ…å¤±è´¥:', error)
    }
  }

  // æˆåŠŸåé‡ç½®è¡¨å•
  useEffect(() => {
    if (isSuccess) {
      setFormData({ message: '', amount: '', count: '', isEven: false })
      toast.success('çº¢åŒ…åˆ›å»ºæˆåŠŸï¼')
    }
  }, [isSuccess])

  return (
    <Card className="max-w-md mx-auto">
      <CardHeader>
        <CardTitle className="flex items-center gap-2">
          <Gift className="w-5 h-5 text-primary-600" />
          åˆ›å»ºçº¢åŒ…
        </CardTitle>
      </CardHeader>
      <CardContent>
        <form onSubmit={handleSubmit} className="space-y-4">
          <div>
            <Label htmlFor="message">ç¥ç¦è¯­</Label>
            <Input
              id="message"
              value={formData.message}
              onChange={(e) => setFormData(prev => ({ ...prev, message: e.target.value }))}
              placeholder="æ­å–œå‘è´¢ï¼Œçº¢åŒ…æ‹¿æ¥ï¼"
              maxLength={100}
            />
            {errors.message && <p className="text-sm text-red-500 mt-1">{errors.message}</p>}
          </div>

          <div>
            <Label htmlFor="amount">çº¢åŒ…æ€»é‡‘é¢ (ETH)</Label>
            <Input
              id="amount"
              type="number"
              step="0.001"
              min="0"
              value={formData.amount}
              onChange={(e) => setFormData(prev => ({ ...prev, amount: e.target.value }))}
              placeholder="0.1"
            />
            {errors.amount && <p className="text-sm text-red-500 mt-1">{errors.amount}</p>}
          </div>

          <div>
            <Label htmlFor="count">çº¢åŒ…ä»½æ•°</Label>
            <Input
              id="count"
              type="number"
              min="1"
              max="100"
              value={formData.count}
              onChange={(e) => setFormData(prev => ({ ...prev, count: e.target.value }))}
              placeholder="5"
            />
            {errors.count && <p className="text-sm text-red-500 mt-1">{errors.count}</p>}
          </div>

          <div className="flex items-center justify-between">
            <Label htmlFor="isEven" className="text-sm font-medium">
              å‡åˆ†æ¨¡å¼
            </Label>
            <Switch
              id="isEven"
              checked={formData.isEven}
              onCheckedChange={(checked) => setFormData(prev => ({ ...prev, isEven: checked }))}
            />
          </div>

          {formData.amount && formData.count && (
            <div className="p-3 bg-gray-50 rounded-lg text-sm">
              {formData.isEven ? (
                <p>æ¯ä¸ªçº¢åŒ…: <span className="font-semibold">{(parseFloat(formData.amount) / parseInt(formData.count)).toFixed(6)} ETH</span></p>
              ) : (
                <p>éšæœºçº¢åŒ…: <span className="font-semibold">0.000001 ~ {(parseFloat(formData.amount) / parseInt(formData.count) * 2).toFixed(6)} ETH</span></p>
              )}
            </div>
          )}

          <Button 
            type="submit" 
            className="w-full" 
            disabled={isLoading}
            size="lg"
          >
            {isLoading ? (
              <>
                <Loader2 className="w-4 h-4 mr-2 animate-spin" />
                åˆ›å»ºä¸­...
              </>
            ) : (
              <>
                <Gift className="w-4 h-4 mr-2" />
                åˆ›å»ºçº¢åŒ…
              </>
            )}
          </Button>
        </form>
      </CardContent>
    </Card>
  )
}
```

### 3. çº¢åŒ…åˆ—è¡¨ç»„ä»¶

**src/components/RedPacketList.tsx**:
```tsx
import { useQuery } from '@apollo/client'
import { useAccount } from 'wagmi'
import { formatEther } from 'viem'
import { GET_RED_PACKETS } from '@/graphql/queries'
import { RedPacketCard } from './RedPacketCard'
import { Loader2, Gift } from 'lucide-react'

interface RedPacket {
  id: string
  creator: string
  message: string
  totalAmount: string
  totalCount: number
  claimedCount: number
  isEven: boolean
  creationTime: string
  claims: Array<{
    id: string
    claimer: string
    amount: string
    timestamp: string
  }>
}

export function RedPacketList() {
  const { address } = useAccount()
  const { data, loading, error, refetch } = useQuery(GET_RED_PACKETS, {
    variables: {
      first: 20,
      skip: 0,
      orderBy: 'creationTime',
      orderDirection: 'desc'
    },
    pollInterval: 10000, // 10ç§’è½®è¯¢
  })

  if (loading) {
    return (
      <div className="flex justify-center items-center py-12">
        <Loader2 className="w-8 h-8 animate-spin text-primary-600" />
        <span className="ml-2 text-gray-600">åŠ è½½çº¢åŒ…åˆ—è¡¨ä¸­...</span>
      </div>
    )
  }

  if (error) {
    return (
      <div className="text-center py-12">
        <p className="text-red-500 mb-4">åŠ è½½å¤±è´¥: {error.message}</p>
        <button 
          onClick={() => refetch()} 
          className="px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700"
        >
          é‡è¯•
        </button>
      </div>
    )
  }

  const packets: RedPacket[] = data?.redPackets || []

  if (packets.length === 0) {
    return (
      <div className="text-center py-12">
        <Gift className="w-16 h-16 text-gray-300 mx-auto mb-4" />
        <h3 className="text-lg font-semibold text-gray-600 mb-2">æš‚æ— çº¢åŒ…</h3>
        <p className="text-gray-500">æˆä¸ºç¬¬ä¸€ä¸ªåˆ›å»ºçº¢åŒ…çš„äººå§ï¼</p>
      </div>
    )
  }

  return (
    <div className="space-y-6">
      <h2 className="text-2xl font-bold text-gray-800 mb-6">çº¢åŒ…å¤§å…</h2>
      
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {packets.map((packet) => (
          <RedPacketCard 
            key={packet.id} 
            packet={packet} 
            currentUser={address}
            onClaimed={() => refetch()}
          />
        ))}
      </div>
    </div>
  )
}
```

### 4. çº¢åŒ…å¡ç‰‡ç»„ä»¶

**src/components/RedPacketCard.tsx**:
```tsx
import { useState, useEffect } from 'react'
import { formatEther, type Address } from 'viem'
import { useClaimRedPacket, useHasClaimed } from '@/hooks/useRedPacket'
import { Button } from '@/components/ui/Button'
import { Card, CardContent, CardHeader } from '@/components/ui/Card'
import { Badge } from '@/components/ui/Badge'
import { 
  Gift, 
  Users, 
  Clock, 
  Loader2, 
  CheckCircle2, 
  XCircle,
  Coins,
  User
} from 'lucide-react'
import { toast } from 'sonner'
import { cn } from '@/lib/utils'

interface RedPacketCardProps {
  packet: {
    id: string
    creator: string
    message: string
    totalAmount: string
    totalCount: number
    claimedCount: number
    isEven: boolean
    creationTime: string
    claims: Array<{
      claimer: string
      amount: string
      timestamp: string
    }>
  }
  currentUser?: Address
  onClaimed?: () => void
}

export function RedPacketCard({ packet, currentUser, onClaimed }: RedPacketCardProps) {
  const [showClaims, setShowClaims] = useState(false)
  
  const { claimRedPacket, isLoading } = useClaimRedPacket()
  const { data: hasClaimed } = useHasClaimed(BigInt(packet.id), currentUser)

  const isOwner = currentUser && packet.creator.toLowerCase() === currentUser.toLowerCase()
  const isFullyClaimed = packet.claimedCount >= packet.totalCount
  const canClaim = currentUser && !hasClaimed && !isOwner && !isFullyClaimed

  const handleClaim = async () => {
    if (!canClaim) return

    try {
      await claimRedPacket(BigInt(packet.id))
      // ç­‰å¾…ä¸€å°æ®µæ—¶é—´è®©äº¤æ˜“ç¡®è®¤ï¼Œç„¶ååˆ·æ–°
      setTimeout(() => {
        onClaimed?.()
      }, 2000)
    } catch (error) {
      console.error('æŠ¢çº¢åŒ…å¤±è´¥:', error)
    }
  }

  const formatTime = (timestamp: string) => {
    return new Date(parseInt(timestamp) * 1000).toLocaleString('zh-CN')
  }

  const getRemainingAmount = () => {
    const total = BigInt(packet.totalAmount)
    const claimed = packet.claims.reduce((sum, claim) => sum + BigInt(claim.amount), 0n)
    return total - claimed
  }

  const getStatusColor = () => {
    if (isFullyClaimed) return 'bg-gray-100 text-gray-600'
    if (hasClaimed) return 'bg-green-100 text-green-700'
    if (canClaim) return 'bg-red-100 text-red-700'
    return 'bg-blue-100 text-blue-700'
  }

  const getStatusText = () => {
    if (isFullyClaimed) return 'å·²æŠ¢å®Œ'
    if (hasClaimed) return 'å·²é¢†å–'
    if (isOwner) return 'æˆ‘çš„çº¢åŒ…'
    if (!currentUser) return 'è¯·å…ˆè¿æ¥é’±åŒ…'
    return 'å¯æŠ¢å–'
  }

  return (
    <Card className={cn(
      "relative overflow-hidden transition-all duration-200 hover:shadow-lg",
      canClaim && "border-red-200 hover:border-red-300",
      hasClaimed && "border-green-200",
      isFullyClaimed && "border-gray-200 opacity-75"
    )}>
      <CardHeader className="pb-3">
        <div className="flex justify-between items-start">
          <div className="flex-1">
            <h3 className="font-semibold text-gray-800 mb-1 line-clamp-2">
              {packet.message}
            </h3>
            <div className="flex items-center gap-2 text-sm text-gray-500">
              <User className="w-3 h-3" />
              {packet.creator.slice(0, 6)}...{packet.creator.slice(-4)}
            </div>
          </div>
          <Badge className={getStatusColor()}>
            {getStatusText()}
          </Badge>
        </div>
      </CardHeader>

      <CardContent className="space-y-4">
        <div className="grid grid-cols-2 gap-4 text-sm">
          <div className="flex items-center gap-2">
            <Coins className="w-4 h-4 text-amber-500" />
            <span className="text-gray-600">æ€»é‡‘é¢</span>
          </div>
          <div className="font-semibold text-right">
            {parseFloat(formatEther(BigInt(packet.totalAmount))).toFixed(4)} ETH
          </div>

          <div className="flex items-center gap-2">
            <Users className="w-4 h-4 text-blue-500" />
            <span className="text-gray-600">è¿›åº¦</span>
          </div>
          <div className="font-semibold text-right">
            {packet.claimedCount}/{packet.totalCount}
          </div>

          <div className="flex items-center gap-2">
            <Gift className="w-4 h-4 text-purple-500" />
            <span className="text-gray-600">æ¨¡å¼</span>
          </div>
          <div className="text-right">
            {packet.isEven ? 'å‡åˆ†' : 'éšæœº'}
          </div>

          <div className="flex items-center gap-2">
            <Clock className="w-4 h-4 text-gray-400" />
            <span className="text-gray-600">æ—¶é—´</span>
          </div>
          <div className="text-right text-xs">
            {formatTime(packet.creationTime)}
          </div>
        </div>

        {!isFullyClaimed && (
          <div className="bg-amber-50 p-3 rounded-lg">
            <div className="text-sm text-amber-700">
              å‰©ä½™: {parseFloat(formatEther(getRemainingAmount())).toFixed(4)} ETH
            </div>
            <div className="w-full bg-amber-200 rounded-full h-2 mt-2">
              <div 
                className="bg-amber-500 h-2 rounded-full transition-all duration-300"
                style={{ width: `${(packet.claimedCount / packet.totalCount) * 100}%` }}
              />
            </div>
          </div>
        )}

        {canClaim && (
          <Button
            onClick={handleClaim}
            disabled={isLoading}
            className="w-full bg-red-600 hover:bg-red-700"
            size="lg"
          >
            {isLoading ? (
              <>
                <Loader2 className="w-4 h-4 mr-2 animate-spin" />
                æŠ¢çº¢åŒ…ä¸­...
              </>
            ) : (
              <>
                <Gift className="w-4 h-4 mr-2" />
                æŠ¢çº¢åŒ…
              </>
            )}
          </Button>
        )}

        {packet.claims.length > 0 && (
          <Button
            variant="outline"
            onClick={() => setShowClaims(!showClaims)}
            className="w-full"
            size="sm"
          >
            {showClaims ? 'éšè—' : 'æŸ¥çœ‹'}é¢†å–è®°å½• ({packet.claims.length})
          </Button>
        )}

        {showClaims && packet.claims.length > 0 && (
          <div className="space-y-2 max-h-40 overflow-y-auto">
            {packet.claims.map((claim, index) => (
              <div key={claim.claimer + claim.timestamp} className="flex justify-between items-center text-xs bg-gray-50 p-2 rounded">
                <div className="flex items-center gap-2">
                  <div className="w-6 h-6 bg-green-100 rounded-full flex items-center justify-center">
                    <span className="text-green-600 font-bold">#{index + 1}</span>
                  </div>
                  <span className="text-gray-600">
                    {claim.claimer.slice(0, 6)}...{claim.claimer.slice(-4)}
                  </span>
                </div>
                <div className="font-semibold text-green-600">
                  {parseFloat(formatEther(BigInt(claim.amount))).toFixed(4)} ETH
                </div>
              </div>
            ))}
          </div>
        )}
      </CardContent>
    </Card>
  )
}
```

## ğŸ¯ é«˜çº§ç‰¹æ€§å®ç°

### 1. å®æ—¶çŠ¶æ€æ›´æ–°

**src/hooks/useRealTimeUpdates.ts**:
```typescript
import { useEffect } from 'react'
import { useWatchContractEvent } from 'wagmi'
import { RED_PACKET_ADDRESS, RED_PACKET_ABI } from '@/lib/web3'
import { toast } from 'sonner'
import { formatEther } from 'viem'

export function useRealTimeUpdates() {
  // ç›‘å¬çº¢åŒ…åˆ›å»ºäº‹ä»¶
  useWatchContractEvent({
    address: RED_PACKET_ADDRESS,
    abi: RED_PACKET_ABI,
    eventName: 'PacketCreated',
    onLogs(logs) {
      logs.forEach((log) => {
        const { creator, message, totalAmount } = log.args
        toast.success(
          `æ–°çº¢åŒ…æ¥å•¦ï¼${creator?.slice(0, 6)}...${creator?.slice(-4)} å‘äº†ä¸€ä¸ª ${parseFloat(formatEther(totalAmount!)).toFixed(4)} ETH çš„çº¢åŒ…`,
          {
            duration: 5000,
            action: {
              label: 'å»æŠ¢',
              onClick: () => {
                // æ»šåŠ¨åˆ°çº¢åŒ…åˆ—è¡¨æˆ–åˆ·æ–°é¡µé¢
                window.location.reload()
              }
            }
          }
        )
      })
    }
  })

  // ç›‘å¬çº¢åŒ…é¢†å–äº‹ä»¶
  useWatchContractEvent({
    address: RED_PACKET_ADDRESS,
    abi: RED_PACKET_ABI,
    eventName: 'PacketClaimed',
    onLogs(logs) {
      logs.forEach((log) => {
        const { claimer, amount } = log.args
        toast.info(
          `${claimer?.slice(0, 6)}...${claimer?.slice(-4)} æŠ¢åˆ°äº† ${parseFloat(formatEther(amount!)).toFixed(4)} ETH`,
          { duration: 3000 }
        )
      })
    }
  })

  // ç›‘å¬çº¢åŒ…æŠ¢å®Œäº‹ä»¶
  useWatchContractEvent({
    address: RED_PACKET_ADDRESS,
    abi: RED_PACKET_ABI,
    eventName: 'PacketEmpty',
    onLogs(logs) {
      logs.forEach((log) => {
        toast.warning(`çº¢åŒ… #${log.args.packetId} å·²è¢«æŠ¢å®Œï¼`, { duration: 3000 })
      })
    }
  })
}
```

### 2. é”™è¯¯å¤„ç†ä¸ç”¨æˆ·åé¦ˆ

**src/hooks/useErrorHandler.ts**:
```typescript
import { useEffect } from 'react'
import { toast } from 'sonner'

interface ErrorInfo {
  code?: number
  message?: string
  reason?: string
}

export function useErrorHandler() {
  const handleError = (error: any) => {
    console.error('App Error:', error)

    // è§£æé”™è¯¯ä¿¡æ¯
    let message = 'æ“ä½œå¤±è´¥ï¼Œè¯·é‡è¯•'
    
    if (error?.message?.includes('User rejected')) {
      message = 'ç”¨æˆ·å–æ¶ˆäº†äº¤æ˜“'
    } else if (error?.message?.includes('insufficient funds')) {
      message = 'è´¦æˆ·ä½™é¢ä¸è¶³'
    } else if (error?.message?.includes('gas')) {
      message = 'Gasè´¹ç”¨ä¸è¶³ï¼Œè¯·è°ƒæ•´Gasè®¾ç½®'
    } else if (error?.message?.includes('Already claimed')) {
      message = 'æ‚¨å·²ç»é¢†å–è¿‡è¿™ä¸ªçº¢åŒ…äº†'
    } else if (error?.message?.includes('No packets left')) {
      message = 'çº¢åŒ…å·²è¢«æŠ¢å®Œ'
    } else if (error?.message?.includes('Not exist')) {
      message = 'çº¢åŒ…ä¸å­˜åœ¨'
    } else if (error?.reason) {
      message = error.reason
    } else if (error?.message) {
      // å°è¯•ä»é”™è¯¯æ¶ˆæ¯ä¸­æå–æ›´å‹å¥½çš„ä¿¡æ¯
      const match = error.message.match(/reason="([^"]+)"/)
      if (match) {
        message = match[1]
      } else {
        message = error.message
      }
    }

    toast.error(message, { duration: 5000 })
  }

  // å…¨å±€é”™è¯¯å¤„ç†
  useEffect(() => {
    const handleUnhandledError = (event: ErrorEvent) => {
      handleError(event.error)
    }

    const handleUnhandledRejection = (event: PromiseRejectionEvent) => {
      handleError(event.reason)
    }

    window.addEventListener('error', handleUnhandledError)
    window.addEventListener('unhandledrejection', handleUnhandledRejection)

    return () => {
      window.removeEventListener('error', handleUnhandledError)
      window.removeEventListener('unhandledrejection', handleUnhandledRejection)
    }
  }, [])

  return { handleError }
}
```

### 3. æ€§èƒ½ä¼˜åŒ–

**src/hooks/useOptimizedQuery.ts**:
```typescript
import { useState, useEffect } from 'react'
import { useQuery } from '@apollo/client'

// è™šæ‹Ÿæ»šåŠ¨Hookï¼Œç”¨äºå¤§é‡æ•°æ®çš„æ€§èƒ½ä¼˜åŒ–
export function useVirtualizedList<T>(
  items: T[],
  itemHeight: number,
  containerHeight: number
) {
  const [scrollTop, setScrollTop] = useState(0)
  
  const visibleStart = Math.floor(scrollTop / itemHeight)
  const visibleEnd = Math.min(
    visibleStart + Math.ceil(containerHeight / itemHeight) + 1,
    items.length
  )
  
  const visibleItems = items.slice(visibleStart, visibleEnd)
  
  return {
    visibleItems,
    visibleStart,
    visibleEnd,
    totalHeight: items.length * itemHeight,
    offsetY: visibleStart * itemHeight,
    onScroll: (e: React.UIEvent<HTMLDivElement>) => {
      setScrollTop(e.currentTarget.scrollTop)
    }
  }
}

// æ™ºèƒ½è½®è¯¢Hookï¼Œæ ¹æ®é¡µé¢å¯è§æ€§è°ƒæ•´è½®è¯¢é¢‘ç‡
export function useSmartPolling(baseInterval: number) {
  const [isVisible, setIsVisible] = useState(true)
  const [interval, setInterval] = useState(baseInterval)

  useEffect(() => {
    const handleVisibilityChange = () => {
      const visible = !document.hidden
      setIsVisible(visible)
      // é¡µé¢ä¸å¯è§æ—¶é™ä½è½®è¯¢é¢‘ç‡
      setInterval(visible ? baseInterval : baseInterval * 3)
    }

    document.addEventListener('visibilitychange', handleVisibilityChange)
    return () => {
      document.removeEventListener('visibilitychange', handleVisibilityChange)
    }
  }, [baseInterval])

  return { interval, isVisible }
}

// é˜²æŠ–Hook
export function useDebounce<T>(value: T, delay: number): T {
  const [debouncedValue, setDebouncedValue] = useState<T>(value)

  useEffect(() => {
    const handler = setTimeout(() => {
      setDebouncedValue(value)
    }, delay)

    return () => {
      clearTimeout(handler)
    }
  }, [value, delay])

  return debouncedValue
}
```

## ğŸš€ éƒ¨ç½²ä¸ä¼˜åŒ–

### 1. ç¯å¢ƒå˜é‡é…ç½®

**.env**:
```bash
# ç½‘ç»œé…ç½®
VITE_SEPOLIA_RPC_URL=https://sepolia.infura.io/v3/YOUR_PROJECT_ID
VITE_WALLET_CONNECT_PROJECT_ID=your_wallet_connect_project_id

# åˆçº¦åœ°å€
VITE_RED_PACKET_CONTRACT=0x4e659F1DB6E5475800A6E8d12F0f6dd25c65960f

# å­å›¾URL
VITE_SUBGRAPH_URL=https://api.studio.thegraph.com/query/your-subgraph

# åˆ†æå·¥å…·
VITE_GOOGLE_ANALYTICS_ID=G-XXXXXXXXXX
```

### 2. æ„å»ºä¼˜åŒ–é…ç½®

**vite.config.ts**:
```typescript
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'
import path from 'path'

export default defineConfig({
  plugins: [react()],
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
    },
  },
  build: {
    // æ„å»ºä¼˜åŒ–
    target: 'es2020',
    minify: 'terser',
    terserOptions: {
      compress: {
        drop_console: true,
        drop_debugger: true,
      },
    },
    rollupOptions: {
      output: {
        // ä»£ç åˆ†å‰²
        manualChunks: {
          vendor: ['react', 'react-dom'],
          web3: ['wagmi', 'viem', '@tanstack/react-query'],
          graphql: ['@apollo/client', 'graphql'],
          ui: ['lucide-react', 'sonner'],
        },
      },
    },
    // å¯ç”¨æºæ˜ å°„ç”¨äºç”Ÿäº§è°ƒè¯•
    sourcemap: true,
  },
  server: {
    // å¼€å‘æœåŠ¡å™¨é…ç½®
    port: 3000,
    open: true,
    host: true,
  },
  preview: {
    port: 3001,
  },
})
```

### 3. SEOä¼˜åŒ–

**public/index.html**:
```html
<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/red-packet-icon.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>çº¢åŒ… DApp - å»ä¸­å¿ƒåŒ–çº¢åŒ…ç³»ç»Ÿ</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="å»ä¸­å¿ƒåŒ–çº¢åŒ…ç³»ç»Ÿï¼ŒåŸºäºä»¥å¤ªåŠåŒºå—é“¾ï¼Œæ”¯æŒåˆ›å»ºå’ŒæŠ¢å¤ºETHçº¢åŒ…ï¼Œå®‰å…¨é€æ˜" />
    <meta name="keywords" content="çº¢åŒ…,DApp,ä»¥å¤ªåŠ,åŒºå—é“¾,Web3,å»ä¸­å¿ƒåŒ–" />
    <meta name="author" content="Red Packet DApp Team" />
    
    <!-- Open Graph -->
    <meta property="og:title" content="çº¢åŒ… DApp - å»ä¸­å¿ƒåŒ–çº¢åŒ…ç³»ç»Ÿ" />
    <meta property="og:description" content="å»ä¸­å¿ƒåŒ–çº¢åŒ…ç³»ç»Ÿï¼ŒåŸºäºä»¥å¤ªåŠåŒºå—é“¾" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://red-packet-dapp.com" />
    <meta property="og:image" content="/og-image.jpg" />
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="çº¢åŒ… DApp" />
    <meta name="twitter:description" content="å»ä¸­å¿ƒåŒ–çº¢åŒ…ç³»ç»Ÿ" />
    <meta name="twitter:image" content="/twitter-image.jpg" />
    
    <!-- Favicons -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />
    
    <!-- Preload critical resources -->
    <link rel="preload" href="/fonts/inter-var.woff2" as="font" type="font/woff2" crossorigin />
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
```

### 4. éƒ¨ç½²è„šæœ¬

**scripts/deploy.sh**:
```bash
#!/bin/bash

# æ„å»ºåº”ç”¨
echo "ğŸ—ï¸  æ„å»ºåº”ç”¨..."
npm run build

# æ£€æŸ¥æ„å»ºç»“æœ
if [ ! -d "dist" ]; then
  echo "âŒ æ„å»ºå¤±è´¥"
  exit 1
fi

echo "âœ… æ„å»ºå®Œæˆ"

# éƒ¨ç½²åˆ°Vercel (ç¤ºä¾‹)
echo "ğŸš€ éƒ¨ç½²åˆ°Vercel..."
npx vercel --prod

# æˆ–è€…éƒ¨ç½²åˆ°å…¶ä»–å¹³å°
# echo "ğŸš€ éƒ¨ç½²åˆ°Netlify..."
# npx netlify deploy --prod --dir=dist

echo "âœ… éƒ¨ç½²å®Œæˆ"

# è¿è¡Œéƒ¨ç½²åéªŒè¯
echo "ğŸ” éªŒè¯éƒ¨ç½²..."
curl -f https://red-packet-dapp.vercel.app/health || echo "âš ï¸  å¥åº·æ£€æŸ¥å¤±è´¥"

echo "ğŸ‰ éƒ¨ç½²æµç¨‹å®Œæˆ"
```

## ğŸ“š æœ€ä½³å®è·µæ€»ç»“

### 1. ä»£ç ç»„ç»‡åŸåˆ™
- **ç»„ä»¶å•ä¸€èŒè´£**: æ¯ä¸ªç»„ä»¶åªè´Ÿè´£ä¸€ä¸ªåŠŸèƒ½
- **è‡ªå®šä¹‰Hooks**: æŠ½è±¡ä¸šåŠ¡é€»è¾‘ï¼Œæé«˜å¤ç”¨æ€§
- **ç±»å‹å®‰å…¨**: å…¨é¢ä½¿ç”¨TypeScriptï¼Œå‡å°‘è¿è¡Œæ—¶é”™è¯¯
- **é”™è¯¯è¾¹ç•Œ**: å®ç°é”™è¯¯è¾¹ç•Œç»„ä»¶ï¼Œä¼˜é›…å¤„ç†å¼‚å¸¸

### 2. æ€§èƒ½ä¼˜åŒ–ç­–ç•¥
- **ä»£ç åˆ†å‰²**: æŒ‰è·¯ç”±å’ŒåŠŸèƒ½æ¨¡å—åˆ†å‰²ä»£ç 
- **æ‡’åŠ è½½**: éå…³é”®ç»„ä»¶å»¶è¿ŸåŠ è½½
- **ç¼“å­˜ç­–ç•¥**: åˆç†ä½¿ç”¨React Queryç¼“å­˜
- **è™šæ‹Ÿæ»šåŠ¨**: å¤§é‡æ•°æ®ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨

### 3. ç”¨æˆ·ä½“éªŒä¼˜åŒ–
- **åŠ è½½çŠ¶æ€**: æ‰€æœ‰å¼‚æ­¥æ“ä½œæ˜¾ç¤ºåŠ è½½çŠ¶æ€
- **é”™è¯¯å¤„ç†**: å‹å¥½çš„é”™è¯¯æç¤ºå’Œæ¢å¤å»ºè®®
- **å®æ—¶æ›´æ–°**: ä½¿ç”¨äº‹ä»¶ç›‘å¬å®ç°å®æ—¶æ•°æ®åŒæ­¥
- **å“åº”å¼è®¾è®¡**: é€‚é…å„ç§è®¾å¤‡å±å¹•

### 4. å®‰å…¨æ€§è€ƒè™‘
- **è¾“å…¥éªŒè¯**: æ‰€æœ‰ç”¨æˆ·è¾“å…¥è¿›è¡Œå‰ç«¯éªŒè¯
- **ç¯å¢ƒå˜é‡**: æ•æ„Ÿä¿¡æ¯ä½¿ç”¨ç¯å¢ƒå˜é‡ç®¡ç†
- **HTTPS**: ç”Ÿäº§ç¯å¢ƒå¼ºåˆ¶ä½¿ç”¨HTTPS
- **å†…å®¹å®‰å…¨ç­–ç•¥**: è®¾ç½®é€‚å½“çš„CSPå¤´

### 5. å¼€å‘æ•ˆç‡æå‡
- **çƒ­é‡è½½**: å¼€å‘ç¯å¢ƒå¿«é€Ÿåé¦ˆ
- **ç±»å‹æ£€æŸ¥**: ç¼–è¯‘æ—¶å‘ç°ç±»å‹é”™è¯¯
- **ä»£ç æ ¼å¼åŒ–**: ä½¿ç”¨Prettierå’ŒESLint
- **Git Hooks**: æäº¤å‰è‡ªåŠ¨æ£€æŸ¥ä»£ç è´¨é‡

é€šè¿‡è¿™å¥—å®Œæ•´çš„å‰ç«¯å¼€å‘æŒ‡å—ï¼Œæˆ‘ä»¬æ„å»ºäº†ä¸€ä¸ªç°ä»£åŒ–ã€é«˜æ€§èƒ½ã€ç”¨æˆ·å‹å¥½çš„Web3çº¢åŒ…åº”ç”¨ã€‚æ•´ä¸ªå¼€å‘è¿‡ç¨‹ä½“ç°äº†ç°ä»£å‰ç«¯å¼€å‘çš„æœ€ä½³å®è·µï¼Œä¸ºç±»ä¼¼çš„DAppé¡¹ç›®æä¾›äº†å¾ˆå¥½çš„å‚è€ƒæ¨¡æ¿ã€‚